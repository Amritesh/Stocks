<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantStop | Optimal Liquidation Simulator</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="dark-mode">
    <header>
        <div class="logo-container">
            <span class="logo-icon">ðŸ“Š</span>
            <h1>QuantStop</h1>
        </div>
        <div class="data-status" id="data-status">
            Source: <span id="status-source">---</span> | Last: <span id="status-date">---</span>
        </div>
    </header>

    <main>
        <aside class="sidebar">
            <section class="control-group">
                <h3>Asset & Horizon</h3>
                <div class="input-item">
                    <label for="ticker">Ticker (e.g., TSLA, HDFCBANK.NS)</label>
                    <input type="text" id="ticker" value="TSLA" placeholder="AAPL">
                </div>
                <div class="input-item">
                    <label for="horizon">Horizon (Days): <span id="horizon-val">22</span></label>
                    <input type="range" id="horizon" min="5" max="60" value="22">
                </div>
            </section>

            <section class="control-group">
                <h3>Market Parameters</h3>
                <div class="input-item">
                    <label for="risk-free">Risk-Free Rate r (%)</label>
                    <input type="number" id="risk-free" value="6.5" step="0.1">
                </div>
                <div class="input-item">
                    <label for="yield">Div/Carry Yield q (%)</label>
                    <input type="number" id="yield" value="0.0" step="0.1">
                </div>
                <div class="input-item">
                    <label for="vol-mode">Volatility Mode</label>
                    <select id="vol-mode">
                        <option value="rolling">Historical (Rolling)</option>
                        <option value="manual">Manual</option>
                    </select>
                </div>
                <div id="rolling-vol-group" class="input-item">
                    <label for="vol-window">Rolling Window (Days)</label>
                    <select id="vol-window">
                        <option value="63">63 (3M)</option>
                        <option value="126" selected>126 (6M)</option>
                        <option value="252">252 (1Y)</option>
                    </select>
                </div>
                <div id="manual-vol-group" class="input-item hidden">
                    <label for="vol-manual">Annual Sigma (%)</label>
                    <input type="number" id="vol-manual" value="30" step="1">
                </div>
                <div class="sigma-display">
                    Est. Annual Ïƒ: <span id="sigma-est">--%</span>
                </div>
            </section>

            <section class="control-group">
                <h3>Simulation Settings</h3>
                <div class="input-item">
                    <label for="paths">Monte Carlo Paths: <span id="paths-val">5000</span></label>
                    <input type="range" id="paths" min="1000" max="30000" step="1000" value="5000">
                </div>
                <div class="input-item">
                    <label for="seed">Random Seed</label>
                    <input type="number" id="seed" value="42">
                </div>
                <div class="input-item">
                    <label for="cost">Transaction Cost (bps)</label>
                    <input type="number" id="cost" value="10" step="1">
                </div>
                <div class="input-item">
                    <label for="objective">Objective</label>
                    <select id="objective">
                        <option value="max_ev">Max Expected Proceeds</option>
                        <option value="mean_var">Mean-Variance</option>
                    </select>
                </div>
                <div id="lambda-group" class="input-item hidden">
                    <label for="lambda">Risk Penalty (Î»): <span id="lambda-val">0</span></label>
                    <input type="range" id="lambda" min="0" max="5" step="0.1" value="0">
                </div>
                <div class="input-item">
                    <label for="basis">LSMC Basis Degree</label>
                    <select id="basis">
                        <option value="2">2: [1, S, SÂ²]</option>
                        <option value="3">3: [1, S, SÂ², SÂ³]</option>
                    </select>
                </div>
            </section>

            <button id="run-btn" class="primary-btn">Update & Simulate</button>
        </aside>

        <section class="content-area">
            <div class="chart-container main-chart-box">
                <div class="chart-header">
                    <div class="chart-controls">
                        <button class="timeframe-btn" data-days="1825">5Y</button>
                        <button class="timeframe-btn" data-days="1095">3Y</button>
                        <button class="timeframe-btn active" data-days="365">1Y</button>
                        <button class="timeframe-btn" data-days="30">1M</button>
                    </div>
                    <div class="overlay-controls">
                        <label><input type="checkbox" id="toggle-ma50"> MA50</label>
                        <label><input type="checkbox" id="toggle-ma200"> MA200</label>
                        <label><input type="checkbox" id="toggle-vol"> Vol Band</label>
                    </div>
                </div>
                <div id="main-chart" class="chart-canvas"></div>
            </div>

            <div class="dashboard-grid">
                <div class="decision-card" id="decision-card">
                    <div class="decision-status">---</div>
                    <div class="decision-metric">
                        <span class="label">Boundary Today:</span>
                        <span class="value" id="boundary-today">--</span>
                    </div>
                    <div class="decision-metric">
                        <span class="label">Spot Price:</span>
                        <span class="value" id="spot-price">--</span>
                    </div>
                    <p class="rationale" id="rationale">Enter a ticker and click run to analyze.</p>
                </div>
                <div class="chart-container mini-chart">
                    <h4>Stopping Boundary Curve</h4>
                    <div id="boundary-chart" class="chart-canvas small"></div>
                </div>
                <div class="chart-container mini-chart">
                    <h4>MC Fan Chart (Price vs Boundary)</h4>
                    <div id="fan-chart" class="chart-canvas small"></div>
                </div>
            </div>
        </section>
    </main>

    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
        <p id="loading-text">Fetching data...</p>
    </div>

    <script src="app.js"></script>
</body>
</html>
